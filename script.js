var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,c){a.raw=c;return a};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var c,b=[];!(c=a.next()).done;)b.push(c.value);return b};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};var is2player,isBlackBot=Math.floor(2*Math.random()),modal=document.getElementById("modal"),boardHistory=[],lightTileCol="#cfcfcf",darkTileCol="#614796",boardBorderCol="#3f3f3f",lightTheme=0==Math.floor(20*Math.random());
lightTheme&&(document.body.style.background="#d8a2cf",document.getElementById("modal-content").style.backgroundColor="rgba(60, 60, 60, 0.85)",lightTileCol="#fff",darkTileCol="#fcb8ea",boardBorderCol="#fff");document.getElementById("playbot").onclick=function(){hideModal();is2player=!1;isBlackBot&&setTimeout(MakeAiMove,200)};document.getElementById("2player").onclick=function(){hideModal();is2player=!0};
function hideModal(){lightTheme||(document.body.style.background="#221c25");modal.style.visibility="hidden";document.getElementById("modal-content").style.visibility="visible";document.getElementById("modal-content").classList.add("hide");setTimeout(function(){document.getElementById("modal-content").classList.remove("hide");document.getElementById("2player").style.display="none";document.getElementById("playbot").style.display="none";modal.style.visibility="visible";modal.style.display="none"},300)}
var canvas=document.getElementById("board");window.addEventListener("resize",resizeCanvas);function resizeCanvas(){canvas.width=Math.min(window.innerHeight,window.innerWidth);canvas.height=canvas.width;refresh()}GetBoardWasm=Module.cwrap("get_board","string",[null]);function GetBoard(){var a=GetBoardWasm().slice(0,64);isBlackBot&&(a=[].concat($jscomp.arrayFromIterable(a)).reverse().join(""));return a}AiMove=Module.cwrap("ai_move",null,["number"]);
UserMove=Module.cwrap("user_move","number",["number","number"]);GetSquares=Module.cwrap("get_squares",null,["number","number"]);Module.onRuntimeInitialized=onRuntimeInitialized;function onRuntimeInitialized(){Module.ccall("init_board",null,[null],[]);resizeCanvas();checkLoaded()}function refresh(){var a=GetBoard();DrawBoard(canvas,a)}var move=new Int8Array(2),depth=5,ply=1;
function movePiece(a,c){var b=a.getBoundingClientRect(),d=a.width/8,e=Math.floor((c.clientX-b.left)/d);c=Math.floor((c.clientY-b.top)/d);b=GetBoard()[8*c+e];if(ply%2==(b==b.toUpperCase())&&"."!=b){refresh();move[0]=8*c+e;isBlackBot&&(move[0]=63-move[0]);d=Module._malloc(20);var f=Module.HEAP32.subarray(d/4,d/4+5);GetSquares(move[0],d);isBlackBot&&(f=f.map(function(g){return 63-g}));DrawMove(a,b,f,e,c);Module._free(d)}else move[1]=8*c+e,isBlackBot&&(move[1]=63-move[1]),e=UserMove(move[0],move[1]),
requestAnimationFrame(refresh),e&&(ply++,endGame()||is2player||(a.style.cursor="wait",setTimeout(MakeAiMove,30)))}function MakeAiMove(){var a=Date.now();ply++;AiMove(depth);300>Date.now()-a&&depth++;canvas.style.cursor="default";refresh();endGame()}
function endGame(){var a=[GetBoard(),boardHistory[3],boardHistory[7]].reduce(function(c,b,d,e){return b==e[0]});if(Module.ccall("is_mainboard_terminal","number",[null],[])||a)return refresh(),setTimeout(function(){var c=Module.ccall("score_mainboard","number",[null],[]),b=document.createElement("p"),d=document.createElement("button");d.innerHTML="play again";document.getElementById("modal-content").appendChild(b);document.getElementById("modal-content").appendChild(d);modal.style.display="block";
if(100==c){b.innerHTML="White Wins!";var e="#000";c="#ff7dbe"}else-100==c?(b.innerHTML="Black Wins!",e="#fff",c="#6832a8"):(b.innerHTML="Draw!",e="#dcdcdc",c="#595fa5");document.getElementById("modal-content").style="background-color: "+c+"; margin: 10% auto; color: "+e+";";b.style="font-size: 60px;";d.classList.add("button-small");d.onclick=function(){location.reload()}},0),!0;boardHistory.push(GetBoard());boardHistory=boardHistory.slice(0,8);return!1}
canvas.addEventListener("mousedown",function(a){movePiece(canvas,a)});var wp=new Image;wp.src="/img/pawnwhite.png";var bp=new Image;bp.src="/img/pawnblack.png";var wk=new Image;wk.src="/img/kingwhite.png";var bk=new Image;bk.src="/img/kingblack.png";function checkLoaded(){wp.complete&&wp.complete&&bp.complete&&wk.complete&&bk.complete?refresh():setTimeout(checkLoaded,50)}
function DrawBoard(a,c){var b=a.getContext("2d"),d=a.width,e=a.height;b.fillStyle=lightTileCol;b.fillRect(0,0,d,e);nRow=nCol=8;d/=nCol;e/=nRow;for(var f=0;f<nRow;++f)for(var g=0;g<nCol;++g){0==g%2&&(b.fillStyle=darkTileCol,b.fillRect(g*d+(f%2?0:d),f*e,d,e));var h=c[8*f+g];"."!=h&&DrawImage(h,b,g*d,f*e,d,e)}b.strokeStyle=boardBorderCol;b.lineWidth="5";b.beginPath();b.rect(0,0,a.width,a.height);b.stroke();b.strokeStyle="#000"}
function DrawImage(a,c,b,d,e,f){"p"==a?c.drawImage(bp,b,d,e,f):"P"==a?c.drawImage(wp,b,d,e,f):"k"==a?c.drawImage(bk,b,d,e,f):"K"==a&&c.drawImage(wk,b,d,e,f)}
function DrawMove(a,c,b,d,e){var f=a.getContext("2d");a=a.width/8;f.lineWidth="3";f.fillStyle="#241430";f.fillRect(d*a,e*a,a,a);DrawImage(c,f,d*a,e*a,a,a);f.beginPath();f.rect(d*a,e*a,a,a);f.stroke();for(i=0;5>i;i++)-1!=b[i]&&(d=b[i]%8,e=Math.floor(b[i]/8),f.beginPath(),f.rect(d*a,e*a,a,a),f.stroke(),f.globalAlpha=.2,f.fillStyle="#fc03ec",f.fillRect(d*a,e*a,a,a),f.globalAlpha=1)};
